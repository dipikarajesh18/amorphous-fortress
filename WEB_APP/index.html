<html>
    <head>
        <title>Amorphous Fortress - Entity Editor</title> 
        <link rel="stylesheet" href="app_style.css">
        <!-- ADD STYLES TO SHEET WHEN FINISHED -->
        <style>

            #magic-button{
                float:right;
                height: 100%;
                width: 80px;
                text-align: center;
                line-height: 32px;
                font-size: 22px;
                font-family: Proggy;
                font-weight: bold;
                color: #171717;
                cursor: pointer;
                border-left: #000 2px solid;
                background-color:#f00;
            }



        </style>
    </head>
    <body onload="init()">
        <div id="title">
            Amorphous Fortress - Entity Editor
        </div>
        <div id="container">
            <!-- TOP BAR MENU w/ DROPDOWN -->

            <!-- TODO: Make the submenu disappear after a selection -->

            <div id="menu">
                <div class="menu-item">File
                    <div id='file_menu' class="menu-dropdown">
                        <div class="menudrop-item" onclick="newGraph();">New</div>
                        <div class="menudrop-item" onclick="document.getElementById('entFileIn').click();">Open</div>
                            <input type="file" id="entFileIn" style="display: none;" accept=".txt" onchange="readEntFile();"/>
                        <!-- <div class="menudrop-item">Save</div> -->
                        <div class="menudrop-item" onclick="exportEntGraph();">Save As</div>
                    </div>
                </div>
                

                <div class="menu-item">Edit
                    <div id='edit_menu' class="menu-dropdown">
                        <div class="menudrop-item" onclick="orderGraph();">Organize Graph</div>
                        <div class="menudrop-item">New Node</div>
                        <div class="menudrop-item">New Edge</div>
                        <div class="menudrop-item">Delete Node</div>
                        <div class="menudrop-item">Delete Edge</div>
                    </div>
                </div>


                <!-- <div class="menu-item">View
                    <div id='view_menu' class="menu-dropdown">
                        <div class="menudrop-item">Zoom In</div>
                        <div class="menudrop-item">Zoom Out</div>
                        <div class="menudrop-item">Zoom Reset</div>
                        <div class="menudrop-item">Toggle Grid Snap</div>
                        <div class="menudrop-item">Clean Up Graph</div>
                    </div>
                </div> -->


                <div class="menu-item">Help
                    <div id='help_menu' class="menu-dropdown">
                        <div class="menudrop-item">About</div>
                        <div class="menudrop-item">Quick Start</div>
                        <div class="menudrop-item">Documentation</div>
                        <div class="menudrop-item">Report Bug</div>
                    </div>
                </div>

                <!-- FOR DEBUGGNG -->
                <!-- <div id="magic-button" onclick="">Magic Button</div> -->

            </div>
            <!-- GRAPH NODE EDITOR CANVAS -->
            <div id="gfx-editor">
                <canvas id="graph-canvas" width="625" height="615"></canvas>
            </div>
            <!-- SIDE BAR TEXT EDITOR -->
            <div id="txt-editor">
                <!-- name -->
                <div id="entity-name">
                    <div id="char_div">
                        <input type="text" id="char_in" maxlength="1" placeholder="?" value="@"/>
                        <div id="char_txt"></div>
                    </div>
                    <div id="name_div">
                        <input type="text" id="name_in" placeholder="entity_name" value="Link"/>
                        <div id="name_txt"></div>
                    </div>
                </div>

                <!-- nodes -->
                <div id="entity-nodes">
                    <div class="txt-title">NODES</div>
                    <div id="node-list">
                        
                    </div>
                </div>

                <!-- edges -->
                <div id="entity-edges">
                    <div class="txt-title">EDGES</div>
                    <div id="edge-list">
                        
                    </div>
                </div>
            </div>
        </div>

        <div id="debug"><< DEBUG HERE >></div>

        <!-- MOVE THIS TO SCRIPTS LATER WHEN IT'S FUNCTIONAL -->
        <script>
            let debug = document.getElementById("debug");
            function DEBUG(txt){
                debug.innerHTML = txt;
            }


            
        </script>
        <script src="js/text_ui.js"></script>
        <script src="js/graph_ui.js"></script>

        <!-- REMOVE THESE SCRIPTS OR PUT THEM SOMEWHERE ELSE - PURELY FOR TEST PURPOSES -->
        <script>
            function fakeGraph(){
                CUR_NAME = "phd"
                CUR_CHAR = "@"
                CUR_NODES = ["idle","meme","code"]
                CUR_EDGES = {
                    "0-1":"step 10",
                    "1-0":"none",
                    "0-2":"nextTo c",
                    "2-2":"none",
                    "2-1": "within m",
                    "1-2": "none"
                }
                
            }

            // it's the initial function, init?
            function init(){
                fakeGraph();
                addCurGraphDivs();
                makeNodes();
                makeEdges();

                setInterval(renderGraph, 10);   //wait 10ms before rendering graph (to load the fonts)
            }

            // main loop
            // function main(){
            //     requestAnimationFrame(main); 

            //     renderGraph();  //called already by the 
            // }
            // main();

            // debug keypress
            window.addEventListener("keydown", function(e){ 
                if(e.keyCode == 191){  // ? key
                    DEBUG("hiding all menus");
                    hideAllMenus();
                }
            });
        </script>
    </body>
</html>