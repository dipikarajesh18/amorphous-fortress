<html>
    <head>
        <title>Trig Test</title>
        <style>
            body{
                background-color: #dedede;
            }
            canvas{
                width: 400px;
                height: 400px;
                background-color: #fff;
                margin: 50px auto 10px auto;
                text-align: center;
                border: 1px solid black;
                display:block;
            }
            #coords{
                text-align: center;
                margin: 0 auto;
                color:#000;
            }
            #button_set{
                text-align: center;
                margin: auto;
                display:block;
            }
            button{
                margin: 10px;
            }

        </style>
    </head>
    <body >
        <canvas id="graph-canvas"></canvas>
        <div id="coords"></div>
        <div id="button_set">
            <button onclick="bisect()">Bisection</button>
            <button onclick="atan2()">atan2</button>
        </div>
        <!-- <button onclick="render()">Re-render</button> -->

        <script>
            let canvas = document.getElementById("graph-canvas");
            canvas.width = 400;
            canvas.height = 400;
            let ctx = canvas.getContext("2d");

            let off = 10;  //offset of grid
            let s = 8;     //size of points
            let d = 4;     //distance between points (take distance from bisector to a)
 
            // draw onto the canvas
            let a = {x: 20, y:22}
            let b = null;

            function slope(a,b){
                return (b.y-a.y)/(b.x-a.x);   //JS coordinates use top left as origin
            }
            
            function dist(a,b){
                return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2));
            }

            // bisectional
            function bisect(){
                b = {x:Math.floor(Math.random()*20)+10, y:Math.floor(Math.random()*20)+10}
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // make grid lines
                ctx.strokeStyle = "#dedede";
                ctx.lineWidth = 1;
                for(let i = 0; i < canvas.width; i+=off){
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                    ctx.stroke();
                }
                for(let i = 0; i < canvas.height; i+=off){
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }

                // draw points (a = red, b = blue)
                ctx.fillStyle = "#f00";
                ctx.fillRect(a.x*off-(s/2), a.y*off-(s/2), s, s);

                ctx.fillStyle = "#00f";
                ctx.fillRect(b.x*off-(s/2), b.y*off-(s/2), s, s);

                // draw line between points a + b
                ctx.strokeStyle = "#000";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(a.x*off, a.y*off);
                ctx.lineTo(b.x*off, b.y*off);
                ctx.stroke();

                //draw the midpoint
                let mid = {x:(a.x+b.x)/2, y:(a.y+b.y)/2};
                ctx.fillStyle = "#0f0";
                ctx.fillRect(mid.x*off-(s/2), mid.y*off-(s/2), s, s);

                //draw the perpendicular bisector
                let perp_slope = null;
                if(slope(a,b) == 0){
                    perp_slope = Infinity;
                }else if(slope(a,b) == Infinity){
                    perp_slope = 0;
                }else{
                    perp_slope = -1/slope(a,b);
                }

                // EQUATION OF BISECTOR: y - mid.y = perp_slope(x - mid.x) 
                d = dist(a,mid);  //distance between a and mid
                dx = d*Math.cos(Math.atan(perp_slope));
                dy = d*Math.sin(Math.atan(perp_slope));


                let alt_points = [
                    {x:mid.x+dx, y:mid.y+dy},
                    {x:mid.x-dx, y:mid.y-dy}
                ]

                // draw alt points
                ctx.fillStyle = "#ffabab";
                ctx.fillRect(alt_points[0].x*off-(s/2), alt_points[0].y*off-(s/2), s, s);

                ctx.fillStyle = "#ababff";
                ctx.fillRect(alt_points[1].x*off-(s/2), alt_points[1].y*off-(s/2), s, s);

                document.getElementById("coords").innerHTML = `A:(${a.x},${a.y}) B:${b.x},${b.y} | Slope: ${slope(a,b).toFixed(2)} | D: ${d.toFixed(2)} | Mid: ${mid.x}, ${mid.y}`
                document.getElementById("coords").innerHTML += `<br>Perp Slope: ${perp_slope.toFixed(2)} | dx: ${dx.toFixed(2)} | dy: ${dy.toFixed(2)}`
                document.getElementById("coords").innerHTML += `<br>Alt Points: (${alt_points[0].x},${alt_points[0].y}) (${alt_points[1].x},${alt_points[1].y})`
            }

            // check angle
            function atan2(){
                a = {x:20, y:20};
                b = {x:Math.floor(Math.random()*25)+5, y:Math.floor(Math.random()*25)+5}
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // make grid lines
                ctx.strokeStyle = "#dedede";
                ctx.lineWidth = 1;
                for(let i = 0; i < canvas.width; i+=off){
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                    ctx.stroke();
                }
                for(let i = 0; i < canvas.height; i+=off){
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                    ctx.stroke();
                }

                // draw points (a = red, b = blue)
                ctx.fillStyle = "#f00";
                ctx.fillRect(a.x*off-(s/2), a.y*off-(s/2), s, s);

                ctx.fillStyle = "#00f";
                ctx.fillRect(b.x*off-(s/2), b.y*off-(s/2), s, s);

                // draw line between points a + b
                ctx.strokeStyle = "#000";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(a.x*off, a.y*off);
                ctx.lineTo(b.x*off, b.y*off);
                ctx.stroke();

                // write the angle 
                let angle = Math.atan2(b.y-a.y, b.x-a.x);
                document.getElementById("coords").innerHTML = `A:(${a.x},${a.y}) B:${b.x},${b.y} | Angle: ${angle.toFixed(2)}`



                // make a circle r distance at the same angle from b
                let r = 5;
                ctx.beginPath();
                ctx.arc(b.x*off, b.y*off, r*off, 0, 2 * Math.PI);
                ctx.stroke();

                // make a mini circle at the angle from b
                let r2 = 2;
                ctx.strokeStyle = "#f00";
                ctx.beginPath();
                ctx.arc((b.x+r*(6/5)*Math.cos(angle))*off, (b.y+r*(6/5)*Math.sin(angle))*off, r2*off, 0, 2 * Math.PI);
                ctx.stroke();
                ctx.strokeStyle = "#000";


            }

        </script>
    </body>
</html>l